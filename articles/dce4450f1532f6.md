---
title: "Flutter Ã— Shader å…¥é–€â‘¡"
emoji: "ğŸŒ—"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [flutter, shader]
published: false
---
# ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
&emsp;æ–°ãŸã«Shaderã‚’ä½œã‚‹ãŸã³ã«ã€Shaderã¨ç”»åƒã‚’èª­ã¿è¾¼ã‚€ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ãã®ã¯é¢å€’ã§ã™ã€‚ã¾ãŸã‚‚ã£ã¨å·¥å¤«ã—ãŸShaderã‚’ä½œæˆã—ã‚ˆã†ã¨æ€ã†ã¨ã€ã©ã†ã—ã¦ã‚‚uniformå¤‰æ•°ã®æ•°ãŒå¢—ãˆã¦ãã¾ã™ã€‚ãã®åº¦ã«`setFloat`ã‚„`setImageSampler`ã‚’æ›¸ã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ã®ã‚‚é¢å€’ã§ã™ã€‚ãã“ã§`util/shader_util.dart`ã‚’ç”¨æ„ã—ã¾ã™ã€‚

**util/shader_util.dart**
```
import 'dart:ui';
import 'dart:ui' as ui;

import 'package:flutter/cupertino.dart';
import 'package:flutter/services.dart';

extension FgShaderEx on FragmentShader {
  void setUniforms(List<dynamic> uniforms) {
    int index = 0;
    for(final data in uniforms) {
      if(data is Size) {
        setFloat(index++, data.width);
        setFloat(index++, data.height);
      } else if(data is double) {
        setFloat(index++, data);
      } else if(data is Color) {
        setFloat(index++, data.red.toDouble());
        setFloat(index++, data.green.toDouble());
        setFloat(index++, data.blue.toDouble());
        setFloat(index++, data.alpha.toDouble());
      } else if(data is Offset) {
        setFloat(index++, data.dx);
        setFloat(index++, data.dy);
      }
    }
    final images = uniforms.whereType<ui.Image>().toList();
    for (int i = 0; i < images.length; i++) {
      setImageSampler(i, images[i]);
    }
  }
}

Future<ui.Image> loadUiImage(String path) async {
  final imageData = await rootBundle.load(path);
  return await decodeImageFromList(imageData.buffer.asUint8List());
}

Future<FragmentShader> loadFragmentShader(String path) async {
  final program = await FragmentProgram.fromAsset(path);
  return program.fragmentShader();
}
```